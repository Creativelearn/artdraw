//https://github.com/jankovicsandras/imagetracerjs
!function(){"use strict";function t(){var t=this;this.totalNodes=0,this.totalPaths=0,this.pathStr="",this.versionnumber="1.2.6",this.imageToSVG=function(e,n,s){s=t.checkoptions(s),t.loadImage(e,(function(e){n(t.imagedataToSVG(t.getImgdata(e),s))}),s)},this.imagedataToSVG=function(e,n){n=t.checkoptions(n);var s=t.imagedataToTracedata(e,n);return t.getsvgstring(s,n)},this.imageToTracedata=function(e,n,s){s=t.checkoptions(s),t.loadImage(e,(function(e){n(t.imagedataToTracedata(t.getImgdata(e),s))}),s)},this.imagedataToTracedata=function(e,n){n=t.checkoptions(n);var s=t.colorquantization(e,n);if(0===n.layering)for(var o={layers:[],palette:s.palette,width:s.array[0].length-2,height:s.array.length-2},r=0;r<s.palette.length;r++){var a=t.batchtracepaths(t.internodes(t.pathscan(t.layeringstep(s,r),n.pathomit),n),n.ltres,n.qtres);o.layers.push(a)}else{var i=t.layering(s);n.layercontainerid&&t.drawLayers(i,t.specpalette,n.scale,n.layercontainerid);var l=t.batchpathscan(i,n.pathomit),h=t.batchinternodes(l,n);o={layers:t.batchtracelayers(h,n.ltres,n.qtres),palette:s.palette,width:e.width,height:e.height}}return o},this.optionpresets={default:{corsenabled:!1,ltres:1,qtres:1,pathomit:8,rightangleenhance:!0,colorsampling:2,numberofcolors:16,mincolorratio:0,colorquantcycles:3,layering:0,strokewidth:1,linefilter:!1,scale:1,roundcoords:1,viewbox:!1,desc:!1,lcpr:0,qcpr:0,blurradius:0,blurdelta:20},posterized1:{colorsampling:0,numberofcolors:2},posterized2:{numberofcolors:4,blurradius:5},curvy:{ltres:.01,linefilter:!0,rightangleenhance:!1},sharp:{qtres:.01,linefilter:!1},detailed:{pathomit:0,roundcoords:2,ltres:.5,qtres:.5,numberofcolors:64},smoothed:{blurradius:5,blurdelta:64},grayscale:{colorsampling:0,colorquantcycles:1,numberofcolors:7},fixedpalette:{colorsampling:0,colorquantcycles:1,numberofcolors:27},randomsampling1:{colorsampling:1,numberofcolors:8},randomsampling2:{colorsampling:1,numberofcolors:64},artistic1:{colorsampling:0,colorquantcycles:1,pathomit:0,blurradius:5,blurdelta:64,ltres:.01,linefilter:!0,numberofcolors:16,strokewidth:2},artistic2:{qtres:.01,colorsampling:0,colorquantcycles:1,numberofcolors:4,strokewidth:0},artistic3:{qtres:10,ltres:10,numberofcolors:8},artistic4:{qtres:10,ltres:10,numberofcolors:64,blurradius:5,blurdelta:256,strokewidth:2},posterized3:{ltres:1,qtres:1,pathomit:20,rightangleenhance:!0,colorsampling:0,numberofcolors:3,mincolorratio:0,colorquantcycles:3,blurradius:3,blurdelta:20,strokewidth:0,linefilter:!1,roundcoords:1,pal:[{r:0,g:0,b:100,a:255},{r:255,g:255,b:255,a:255}]}},this.checkoptions=function(e){"string"==typeof(e=e||{})&&(e=e.toLowerCase(),e=t.optionpresets[e]?t.optionpresets[e]:{});for(var n=Object.keys(t.optionpresets.default),s=0;s<n.length;s++)e.hasOwnProperty(n[s])||(e[n[s]]=t.optionpresets.default[n[s]]);return e},this.colorquantization=function(e,n){var s,o,r,a,i,l,h,c,g=[],d=0,p=[],u=e.width*e.height;if(e.data.length<4*u){for(var m=new Uint8ClampedArray(4*u),f=0;f<u;f++)m[4*f]=e.data[3*f],m[4*f+1]=e.data[3*f+1],m[4*f+2]=e.data[3*f+2],m[4*f+3]=255;e.data=m}for(i=0;i<e.height+2;i++)for(g[i]=[],a=0;a<e.width+2;a++)g[i][a]=-1;for(c=n.pal?n.pal:0===n.colorsampling?t.generatepalette(n.numberofcolors):1===n.colorsampling?t.samplepalette(n.numberofcolors,e):t.samplepalette2(n.numberofcolors,e),n.blurradius>0&&(e=t.blur(e,n.blurradius,n.blurdelta)),h=0;h<n.colorquantcycles;h++){if(h>0)for(l=0;l<c.length;l++)p[l].n>0&&(c[l]={r:Math.floor(p[l].r/p[l].n),g:Math.floor(p[l].g/p[l].n),b:Math.floor(p[l].b/p[l].n),a:Math.floor(p[l].a/p[l].n)}),p[l].n/u<n.mincolorratio&&h<n.colorquantcycles-1&&(c[l]={r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())});for(a=0;a<c.length;a++)p[a]={r:0,g:0,b:0,a:0,n:0};for(i=0;i<e.height;i++)for(a=0;a<e.width;a++){for(d=4*(i*e.width+a),r=0,o=1024,l=0;l<c.length;l++)(s=(c[l].r>e.data[d]?c[l].r-e.data[d]:e.data[d]-c[l].r)+(c[l].g>e.data[d+1]?c[l].g-e.data[d+1]:e.data[d+1]-c[l].g)+(c[l].b>e.data[d+2]?c[l].b-e.data[d+2]:e.data[d+2]-c[l].b)+(c[l].a>e.data[d+3]?c[l].a-e.data[d+3]:e.data[d+3]-c[l].a))<o&&(o=s,r=l);p[r].r+=e.data[d],p[r].g+=e.data[d+1],p[r].b+=e.data[d+2],p[r].a+=e.data[d+3],p[r].n++,g[i+1][a+1]=r}}return{array:g,palette:c}},this.samplepalette=function(t,e){for(var n,s=[],o=0;o<t;o++)n=4*Math.floor(Math.random()*e.data.length/4),s.push({r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:e.data[n+3]});return s},this.samplepalette2=function(t,e){for(var n,s=[],o=Math.ceil(Math.sqrt(t)),r=Math.ceil(t/o),a=e.width/(o+1),i=e.height/(r+1),l=0;l<r;l++)for(var h=0;h<o&&s.length!==t;h++)n=4*Math.floor((l+1)*i*e.width+(h+1)*a),s.push({r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:e.data[n+3]});return s},this.generatepalette=function(t){var e,n,s,o=[];if(t<8)for(var r=Math.floor(255/(t-1)),a=0;a<t;a++)o.push({r:a*r,g:a*r,b:a*r,a:255});else{var i=Math.floor(Math.pow(t,1/3)),l=Math.floor(255/(i-1)),h=t-i*i*i;for(e=0;e<i;e++)for(n=0;n<i;n++)for(s=0;s<i;s++)o.push({r:e*l,g:n*l,b:s*l,a:255});for(e=0;e<h;e++)o.push({r:Math.floor(255*Math.random()),g:Math.floor(255*Math.random()),b:Math.floor(255*Math.random()),a:Math.floor(255*Math.random())})}return o},this.layering=function(t){var e,n,s,o,r,a,i,l,h,c,g,d=[],p=0,u=t.array.length,m=t.array[0].length;for(g=0;g<t.palette.length;g++)for(d[g]=[],c=0;c<u;c++)for(d[g][c]=[],h=0;h<m;h++)d[g][c][h]=0;for(c=1;c<u-1;c++)for(h=1;h<m-1;h++)p=t.array[c][h],e=t.array[c-1][h-1]===p?1:0,n=t.array[c-1][h]===p?1:0,s=t.array[c-1][h+1]===p?1:0,o=t.array[c][h-1]===p?1:0,r=t.array[c][h+1]===p?1:0,a=t.array[c+1][h-1]===p?1:0,i=t.array[c+1][h]===p?1:0,l=t.array[c+1][h+1]===p?1:0,d[p][c+1][h+1]=1+2*r+4*l+8*i,o||(d[p][c+1][h]=2+4*i+8*a),n||(d[p][c][h+1]=0+2*s+4*r+8),e||(d[p][c][h]=0+2*n+4+8*o);return d},this.layeringstep=function(t,e){var n,s,o=[],r=t.array.length,a=t.array[0].length;for(s=0;s<r;s++)for(o[s]=[],n=0;n<a;n++)o[s][n]=0;for(s=1;s<r;s++)for(n=1;n<a;n++)o[s][n]=(t.array[s-1][n-1]===e?1:0)+(t.array[s-1][n]===e?2:0)+(t.array[s][n-1]===e?8:0)+(t.array[s][n]===e?4:0);return o},this.pointinpoly=function(t,e){for(var n=!1,s=0,o=e.length-1;s<e.length;o=s++)n=e[s].y>t.y!=e[o].y>t.y&&t.x<(e[o].x-e[s].x)*(t.y-e[s].y)/(e[o].y-e[s].y)+e[s].x?!n:n;return n},this.pathscan_combined_lookup=[[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[13,3,0,1],[13,2,-1,0],[7,1,0,-1],[7,0,1,0]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[0,3,0,1],[0,2,-1,0],[-1,-1,-1,-1],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[0,1,0,-1],[-1,-1,-1,-1],[0,3,0,1]],[[11,1,0,-1],[14,0,1,0],[14,3,0,1],[11,2,-1,0]],[[-1,-1,-1,-1],[0,0,1,0],[0,3,0,1],[-1,-1,-1,-1]],[[0,0,1,0],[-1,-1,-1,-1],[0,2,-1,0],[-1,-1,-1,-1]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[0,1,0,-1],[0,0,1,0]],[[0,1,0,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[0,2,-1,0]],[[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1],[-1,-1,-1,-1]]],this.pathscan=function(e,n){for(var s,o=[],r=0,a=0,i=0,l=0,h=e[0].length,c=e.length,g=0,d=!0,p=!1,u=0;u<c;u++)for(var m=0;m<h;m++)if(4==e[u][m]||11==e[u][m])for(i=m,l=u,o[r]={},o[r].points=[],o[r].boundingbox=[i,l,i,l],o[r].holechildren=[],d=!1,a=0,p=11==e[u][m],g=1;!d;){if(o[r].points[a]={},o[r].points[a].x=i-1,o[r].points[a].y=l-1,o[r].points[a].t=e[l][i],i-1<o[r].boundingbox[0]&&(o[r].boundingbox[0]=i-1),i-1>o[r].boundingbox[2]&&(o[r].boundingbox[2]=i-1),l-1<o[r].boundingbox[1]&&(o[r].boundingbox[1]=l-1),l-1>o[r].boundingbox[3]&&(o[r].boundingbox[3]=l-1),s=t.pathscan_combined_lookup[e[l][i]][g],e[l][i]=s[0],g=s[1],i+=s[2],l+=s[3],i-1===o[r].points[0].x&&l-1===o[r].points[0].y)if(d=!0,o[r].points.length<n)o.pop();else{if(o[r].isholepath=!!p,p){for(var f=0,y=[-1,-1,h+1,c+1],b=0;b<r;b++)!o[b].isholepath&&t.boundingboxincludes(o[b].boundingbox,o[r].boundingbox)&&t.boundingboxincludes(y,o[b].boundingbox)&&t.pointinpoly(o[r].points[0],o[b].points)&&(f=b,y=o[b].boundingbox);o[f].holechildren.push(r)}r++}a++}return o},this.boundingboxincludes=function(t,e){return t[0]<e[0]&&t[1]<e[1]&&t[2]>e[2]&&t[3]>e[3]},this.batchpathscan=function(e,n){var s=[];for(var o in e)e.hasOwnProperty(o)&&(s[o]=t.pathscan(e[o],n));return s},this.internodes=function(e,n){var s,o,r=[],a=0,i=0,l=0,h=0,c=0;for(s=0;s<e.length;s++)for(r[s]={},r[s].points=[],r[s].boundingbox=e[s].boundingbox,r[s].holechildren=e[s].holechildren,r[s].isholepath=e[s].isholepath,a=e[s].points.length,o=0;o<a;o++)i=(o+1)%a,l=(o+2)%a,h=(o-1+a)%a,c=(o-2+a)%a,n.rightangleenhance&&t.testrightangle(e[s],c,h,o,i,l)&&(r[s].points.length>0&&(r[s].points[r[s].points.length-1].linesegment=t.getdirection(r[s].points[r[s].points.length-1].x,r[s].points[r[s].points.length-1].y,e[s].points[o].x,e[s].points[o].y)),r[s].points.push({x:e[s].points[o].x,y:e[s].points[o].y,linesegment:t.getdirection(e[s].points[o].x,e[s].points[o].y,(e[s].points[o].x+e[s].points[i].x)/2,(e[s].points[o].y+e[s].points[i].y)/2)})),r[s].points.push({x:(e[s].points[o].x+e[s].points[i].x)/2,y:(e[s].points[o].y+e[s].points[i].y)/2,linesegment:t.getdirection((e[s].points[o].x+e[s].points[i].x)/2,(e[s].points[o].y+e[s].points[i].y)/2,(e[s].points[i].x+e[s].points[l].x)/2,(e[s].points[i].y+e[s].points[l].y)/2)});return r},this.testrightangle=function(t,e,n,s,o,r){return t.points[s].x===t.points[e].x&&t.points[s].x===t.points[n].x&&t.points[s].y===t.points[o].y&&t.points[s].y===t.points[r].y||t.points[s].y===t.points[e].y&&t.points[s].y===t.points[n].y&&t.points[s].x===t.points[o].x&&t.points[s].x===t.points[r].x},this.getdirection=function(t,e,n,s){return t<n?e<s?1:e>s?7:0:t>n?e<s?3:e>s?5:4:e<s?2:e>s?6:8},this.batchinternodes=function(e,n){var s=[];for(var o in e)e.hasOwnProperty(o)&&(s[o]=t.internodes(e[o],n));return s},this.tracepath=function(e,n,s){var o,r,a,i=0,l={segments:[]};for(l.boundingbox=e.boundingbox,l.holechildren=e.holechildren,l.isholepath=e.isholepath;i<e.points.length;){for(o=e.points[i].linesegment,r=-1,a=i+1;(e.points[a].linesegment===o||e.points[a].linesegment===r||-1===r)&&a<e.points.length-1;)e.points[a].linesegment!==o&&-1===r&&(r=e.points[a].linesegment),a++;a===e.points.length-1&&(a=0),l.segments=l.segments.concat(t.fitseq(e,n,s,i,a)),i=a>0?a:e.points.length}return l},this.fitseq=function(e,n,s,o,r){if(r>e.points.length||r<0)return[];var a,i,l,h=o,c=0,g=!0,d=r-o;d<0&&(d+=e.points.length);for(var p,u=(e.points[r].x-e.points[o].x)/d,m=(e.points[r].y-e.points[o].y)/d,f=(o+1)%e.points.length;f!=r;)(p=f-o)<0&&(p+=e.points.length),a=e.points[o].x+u*p,i=e.points[o].y+m*p,(l=(e.points[f].x-a)*(e.points[f].x-a)+(e.points[f].y-i)*(e.points[f].y-i))>n&&(g=!1),l>c&&(h=f,c=l),f=(f+1)%e.points.length;if(g)return[{type:"L",x1:e.points[o].x,y1:e.points[o].y,x2:e.points[r].x,y2:e.points[r].y}];var y=h;g=!0,c=0;var b=(y-o)/d,x=(1-b)*(1-b),w=2*(1-b)*b,v=b*b,M=(x*e.points[o].x+v*e.points[r].x-e.points[y].x)/-w,k=(x*e.points[o].y+v*e.points[r].y-e.points[y].y)/-w;for(f=o+1;f!=r;)w=2*(1-(b=(f-o)/d))*b,v=b*b,a=(x=(1-b)*(1-b))*e.points[o].x+w*M+v*e.points[r].x,i=x*e.points[o].y+w*k+v*e.points[r].y,(l=(e.points[f].x-a)*(e.points[f].x-a)+(e.points[f].y-i)*(e.points[f].y-i))>s&&(g=!1),l>c&&(h=f,c=l),f=(f+1)%e.points.length;if(g)return[{type:"Q",x1:e.points[o].x,y1:e.points[o].y,x2:M,y2:k,x3:e.points[r].x,y3:e.points[r].y}];var q=y;return t.fitseq(e,n,s,o,q).concat(t.fitseq(e,n,s,q,r))},this.batchtracepaths=function(e,n,s){var o=[];for(var r in e)e.hasOwnProperty(r)&&o.push(t.tracepath(e[r],n,s));return o},this.batchtracelayers=function(e,n,s){var o=[];for(var r in e)e.hasOwnProperty(r)&&(o[r]=t.batchtracepaths(e[r],n,s));return o},this.roundtodec=function(t,e){return+t.toFixed(e)},this.svgpathstring=function(e,n,s,o){var r,a=e.layers[n],i=a[s],l="";if(o.linefilter&&i.segments.length<3)return l;if(l='<path id="'+("trace-"+Math.floor(1e9*Math.random()))+'" class="cosito traced" '+(o.desc?'desc="l '+n+" p "+s+'" ':"")+t.tosvgcolorstr(e.palette[n],o)+'d="',-1===o.roundcoords){for(l+="M "+i.segments[0].x1*o.scale+" "+i.segments[0].y1*o.scale+" ",r=0;r<i.segments.length;r++)l+=i.segments[r].type+" "+i.segments[r].x2*o.scale+" "+i.segments[r].y2*o.scale+" ",i.segments[r].hasOwnProperty("x3")&&(l+=i.segments[r].x3*o.scale+" "+i.segments[r].y3*o.scale+" ");l+="Z "}else{for(l+="M "+t.roundtodec(i.segments[0].x1*o.scale,o.roundcoords)+" "+t.roundtodec(i.segments[0].y1*o.scale,o.roundcoords)+" ",r=0;r<i.segments.length;r++)l+=i.segments[r].type+" "+t.roundtodec(i.segments[r].x2*o.scale,o.roundcoords)+" "+t.roundtodec(i.segments[r].y2*o.scale,o.roundcoords)+" ",i.segments[r].hasOwnProperty("x3")&&(l+=t.roundtodec(i.segments[r].x3*o.scale,o.roundcoords)+" "+t.roundtodec(i.segments[r].y3*o.scale,o.roundcoords)+" ");l+="Z "}for(var h=0;h<i.holechildren.length;h++){var c=a[i.holechildren[h]];if(-1===o.roundcoords)for(c.segments[c.segments.length-1].hasOwnProperty("x3")?l+="M "+c.segments[c.segments.length-1].x3*o.scale+" "+c.segments[c.segments.length-1].y3*o.scale+" ":l+="M "+c.segments[c.segments.length-1].x2*o.scale+" "+c.segments[c.segments.length-1].y2*o.scale+" ",r=c.segments.length-1;r>=0;r--)l+=c.segments[r].type+" ",c.segments[r].hasOwnProperty("x3")&&(l+=c.segments[r].x2*o.scale+" "+c.segments[r].y2*o.scale+" "),l+=c.segments[r].x1*o.scale+" "+c.segments[r].y1*o.scale+" ";else for(c.segments[c.segments.length-1].hasOwnProperty("x3")?l+="M "+t.roundtodec(c.segments[c.segments.length-1].x3*o.scale)+" "+t.roundtodec(c.segments[c.segments.length-1].y3*o.scale)+" ":l+="M "+t.roundtodec(c.segments[c.segments.length-1].x2*o.scale)+" "+t.roundtodec(c.segments[c.segments.length-1].y2*o.scale)+" ",r=c.segments.length-1;r>=0;r--)l+=c.segments[r].type+" ",c.segments[r].hasOwnProperty("x3")&&(l+=t.roundtodec(c.segments[r].x2*o.scale)+" "+t.roundtodec(c.segments[r].y2*o.scale)+" "),l+=t.roundtodec(c.segments[r].x1*o.scale)+" "+t.roundtodec(c.segments[r].y1*o.scale)+" ";l+="Z "}for(l+='" />',r=0;r<i.segments.length;r++)i.segments[r].hasOwnProperty("x3")||this.totalNodes++;for(h=0;h<i.holechildren.length;h++){c=a[i.holechildren[h]];for(r=0;r<c.segments.length;r++)c.segments[r].hasOwnProperty("x3")||this.totalNodes++}if(this.totalPaths++,o.lcpr||o.qcpr){for(r=0;r<i.segments.length;r++)i.segments[r].hasOwnProperty("x3")&&o.qcpr&&(l+='<circle cx="'+i.segments[r].x2*o.scale+'" cy="'+i.segments[r].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',l+='<circle cx="'+i.segments[r].x3*o.scale+'" cy="'+i.segments[r].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',l+='<line x1="'+i.segments[r].x1*o.scale+'" y1="'+i.segments[r].y1*o.scale+'" x2="'+i.segments[r].x2*o.scale+'" y2="'+i.segments[r].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',l+='<line x1="'+i.segments[r].x2*o.scale+'" y1="'+i.segments[r].y2*o.scale+'" x2="'+i.segments[r].x3*o.scale+'" y2="'+i.segments[r].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!i.segments[r].hasOwnProperty("x3")&&o.lcpr&&(l+='<circle cx="'+i.segments[r].x2*o.scale+'" cy="'+i.segments[r].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />');for(h=0;h<i.holechildren.length;h++){c=a[i.holechildren[h]];for(r=0;r<c.segments.length;r++)c.segments[r].hasOwnProperty("x3")&&o.qcpr&&(l+='<circle cx="'+c.segments[r].x2*o.scale+'" cy="'+c.segments[r].y2*o.scale+'" r="'+o.qcpr+'" fill="cyan" stroke-width="'+.2*o.qcpr+'" stroke="black" />',l+='<circle cx="'+c.segments[r].x3*o.scale+'" cy="'+c.segments[r].y3*o.scale+'" r="'+o.qcpr+'" fill="white" stroke-width="'+.2*o.qcpr+'" stroke="black" />',l+='<line x1="'+c.segments[r].x1*o.scale+'" y1="'+c.segments[r].y1*o.scale+'" x2="'+c.segments[r].x2*o.scale+'" y2="'+c.segments[r].y2*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />',l+='<line x1="'+c.segments[r].x2*o.scale+'" y1="'+c.segments[r].y2*o.scale+'" x2="'+c.segments[r].x3*o.scale+'" y2="'+c.segments[r].y3*o.scale+'" stroke-width="'+.2*o.qcpr+'" stroke="cyan" />'),!c.segments[r].hasOwnProperty("x3")&&o.lcpr&&(l+='<circle cx="'+c.segments[r].x2*o.scale+'" cy="'+c.segments[r].y2*o.scale+'" r="'+o.lcpr+'" fill="white" stroke-width="'+.2*o.lcpr+'" stroke="black" />')}}return l},this.getsvgstring=function(e,n){n=t.checkoptions(n);for(var s=e.width*n.scale,o=e.height*n.scale,r="<svg "+(n.viewbox?'viewBox="0 0 '+s+" "+o+'" ':'width="'+s+'" height="'+o+'" ')+'version="1.1" xmlns="http://www.w3.org/2000/svg" desc="Created with imagetracer.js version '+t.versionnumber+'" >',a=0;a<e.layers.length;a++)for(var i=0;i<e.layers[a].length;i++)e.layers[a][i].isholepath||(r+=t.svgpathstring(e,a,i,n),this.pathStr+=t.svgpathstring(e,a,i,n));return r+="</svg>"},this.compareNumbers=function(t,e){return t-e},this.torgbastr=function(t){return"rgba("+t.r+","+t.g+","+t.b+","+t.a+")"},this.tosvgcolorstr=function(t,e){return'fill="rgb('+t.r+","+t.g+","+t.b+')" stroke="rgb('+t.r+","+t.g+","+t.b+')" stroke-width="'+e.strokewidth+'" opacity="'+t.a/255+'" '},this.appendSVGString=function(t,e){var n;e?(n=document.getElementById(e))||((n=document.createElement("div")).id=e,document.body.appendChild(n)):(n=document.createElement("div"),document.body.appendChild(n)),n.innerHTML+=t;var s=document.getElementById("svgInfo");"undefined"!=s&&(s.innerHTML="("+this.totalPaths+" Paths, "+this.totalNodes+" Nodes)")},this.gks=[[.27901,.44198,.27901],[.135336,.228569,.272192,.228569,.135336],[.086776,.136394,.178908,.195843,.178908,.136394,.086776],[.063327,.093095,.122589,.144599,.152781,.144599,.122589,.093095,.063327],[.049692,.069304,.089767,.107988,.120651,.125194,.120651,.107988,.089767,.069304,.049692]],this.blur=function(e,n,s){var o,r,a,i,l,h,c,g,d,p={width:e.width,height:e.height,data:[]};if((n=Math.floor(n))<1)return e;n>5&&(n=5),(s=Math.abs(s))>1024&&(s=1024);var u=t.gks[n-1];for(r=0;r<e.height;r++)for(o=0;o<e.width;o++){for(l=0,h=0,c=0,g=0,d=0,a=-n;a<n+1;a++)o+a>0&&o+a<e.width&&(i=4*(r*e.width+o+a),l+=e.data[i]*u[a+n],h+=e.data[i+1]*u[a+n],c+=e.data[i+2]*u[a+n],g+=e.data[i+3]*u[a+n],d+=u[a+n]);i=4*(r*e.width+o),p.data[i]=Math.floor(l/d),p.data[i+1]=Math.floor(h/d),p.data[i+2]=Math.floor(c/d),p.data[i+3]=Math.floor(g/d)}var m=new Uint8ClampedArray(p.data);for(r=0;r<e.height;r++)for(o=0;o<e.width;o++){for(l=0,h=0,c=0,g=0,d=0,a=-n;a<n+1;a++)r+a>0&&r+a<e.height&&(l+=m[i=4*((r+a)*e.width+o)]*u[a+n],h+=m[i+1]*u[a+n],c+=m[i+2]*u[a+n],g+=m[i+3]*u[a+n],d+=u[a+n]);i=4*(r*e.width+o),p.data[i]=Math.floor(l/d),p.data[i+1]=Math.floor(h/d),p.data[i+2]=Math.floor(c/d),p.data[i+3]=Math.floor(g/d)}for(r=0;r<e.height;r++)for(o=0;o<e.width;o++)i=4*(r*e.width+o),Math.abs(p.data[i]-e.data[i])+Math.abs(p.data[i+1]-e.data[i+1])+Math.abs(p.data[i+2]-e.data[i+2])+Math.abs(p.data[i+3]-e.data[i+3])>s&&(p.data[i]=e.data[i],p.data[i+1]=e.data[i+1],p.data[i+2]=e.data[i+2],p.data[i+3]=e.data[i+3]);return p},this.loadImage=function(t,e,n){var s=new Image;n&&n.corsenabled&&(s.crossOrigin="Anonymous"),s.onload=function(){var t=document.createElement("canvas");t.width=s.width,t.height=s.height,t.getContext("2d").drawImage(s,0,0),e(t)},s.src=t,this.totalNodes=0,this.totalPaths=0,this.pathStr=""},this.getImgdata=function(t){return t.getContext("2d").getImageData(0,0,t.width,t.height)},this.specpalette=[{r:0,g:0,b:0,a:255},{r:128,g:128,b:128,a:255},{r:0,g:0,b:128,a:255},{r:64,g:64,b:128,a:255},{r:192,g:192,b:192,a:255},{r:255,g:255,b:255,a:255},{r:128,g:128,b:192,a:255},{r:0,g:0,b:192,a:255},{r:128,g:0,b:0,a:255},{r:128,g:64,b:64,a:255},{r:128,g:0,b:128,a:255},{r:168,g:168,b:168,a:255},{r:192,g:128,b:128,a:255},{r:192,g:0,b:0,a:255},{r:255,g:255,b:255,a:255},{r:0,g:128,b:0,a:255}],this.drawLayers=function(e,n,s,o){var r,a,i,l,h,c;for(h in s=s||1,o?(c=document.getElementById(o))||((c=document.createElement("div")).id=o,document.body.appendChild(c)):(c=document.createElement("div"),document.body.appendChild(c)),e)if(e.hasOwnProperty(h)){r=e[h][0].length,a=e[h].length;var g=document.createElement("canvas");g.width=r*s,g.height=a*s;var d=g.getContext("2d");for(l=0;l<a;l++)for(i=0;i<r;i++)d.fillStyle=t.torgbastr(n[e[h][l][i]%n.length]),d.fillRect(i*s,l*s,s,s);c.appendChild(g)}}}"function"==typeof define&&define.amd?define((function(){return new t})):"undefined"!=typeof module?module.exports=new t:"undefined"!=typeof self?self.ImageTracer=new t:window.ImageTracer=new t}();